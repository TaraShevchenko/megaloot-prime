Документ фиксирует функциональность MVP для:
- страницы `welcome` (вход в игру);
- страницы `game` (основной экран).

Контекст фичей (см. соответствующие документы): `Monsters`, `Equipment inventory`, `Equipped items`, `Craft inventory (currency inventory)`, `Store`.

![[GamePage.png]]

## Термины
- **Сессия** (save/game session): состояние игры, сохранённое в `localStorage`.
- **Equipment inventory**: инвентарь экипировки персонажа (все предметы экипировки, которыми владеет игрок).
- **Equipped items**: экипированные предметы (строгие слоты по типам).
- **Craft inventory**: окно применения валют/ресурсов к предмету (центральный слот предмета + фиксированные слоты валют + таблица статов предмета).
- **Store**: магазин экипировки с ценами в золоте; покупка переносит предмет в `Equipment inventory`. Открывается поверх монстров.
- **Валюта/ресурс**: объект с количеством (например, золото, пыль, гемы, капли, слитки).
- **Монстр**: сущность с набором статов и `HP` (как состояние), умирает при `HP <= 0` и выдаёт дроп с шансами.

## Страница `welcome` (вход в MVP)
### Функции
1) Проверка сохранения
- При открытии `welcome` приложение проверяет наличие валидной сессии в `localStorage`.

2) Кнопка действия
- Если данных нет: показывается `Start New Game`.
- Если данные есть: показывается `Continue`.

3) `Start New Game`
- Создаёт новую сессию: дефолтные статы героя, стартовая экипировка/валюты, дефолтный набор монстров.
- Сохраняет сессию в `localStorage`.
- Переходит на страницу `game`.

4) `Continue`
- Загружает сессию из `localStorage`.
- Переходит на страницу `game`.

## Страница `game` (MVP)
### Layout (визуальная структура)
- Экран разделён на 2 колонки:
  - Левая зона: ~60% ширины.
  - Правая зона: ~40% ширины.

Левая зона:
- Верх/центр: монстры (несколько в ряд, допускаются несколько рядов).
- `Store` при открытии отображается **оверлеем поверх монстров**.

Правая зона (рекомендуемый порядок):
1) `Equipped items` (слоты экипировки).
2) Таблица статов героя.
3) `Equipment inventory` (инвентарь экипировки).
4) `Craft inventory` (валюты + центральный слот предмета + таблица статов предмета).

### Monsters
1) Отображение
- На странице показывается набор монстров (2+), расположенных «в ряд».
- У каждого монстра:
  - `HP` (текущий/максимальный) + полоска.
  - спрайт/анимация (MVP: достаточно статичного изображения или минимального набора состояний).

2) Действия (MVP)
- Достаточно одного действия: `Attack`.
- Реализация:
  - Вариант A: кнопка `Attack` у каждого монстра.
  - Вариант B: одна кнопка `Attack` + выбор цели (добавляет механику выбора).

3) Результат атаки (MVP минимум)
- По нажатию `Attack`:
  - вычисляется урон (можно фиксированный урон для MVP);
  - у цели уменьшается `HP`;
  - при `HP <= 0` монстр умирает.

4) Дроп (MVP)
- После смерти монстра выполняется ролл дропа с шансами.
- Дроп добавляется в сессию:
  - предметы экипировки → в `Equipment inventory`;
  - валюты/ресурсы → в коллекцию валют (используется в `Craft inventory` и `Store`).

5) Состояние
- Список монстров и их состояние (`HP`, статус жив/мёртв, параметры дропа) хранится в сессии, чтобы `Continue` восстанавливал прогресс.

### Equipment inventory
1) Отображение
- Сетка слотов, в каждом слоте может быть только предмет экипировки (любой тип).
- Для предмета в MVP достаточно: иконки + имени (подсказка по наведению опционально).

2) Взаимодействия (MVP)
- Перемещение предмета:
  - в `Equipped items` (экипировать);
  - в `Craft inventory` (положить в центральный слот для улучшений).
- Если Drag&Drop сложно — допускается `click-to-equip` / `click-to-craft` как упрощение, но логика ограничений должна соблюдаться.

3) Состояние
- `Equipment inventory` хранится в сессии.

### Equipped items
1) Набор слотов (MVP)
- Строгие слоты по типам: `NECKLACE`, `HELMET`, `GLOVES`, `RING`×2, `ARMOR`, `WEAPON`, `TROUSERS`, `BOOTS`.

2) Правила
- Каждый слот принимает только свой тип экипировки.
- При попытке экипировать неподходящий тип — показать всплывающее уведомление об ошибке.
- Если слот уже занят и экипируется новый подходящий предмет — происходит `swap` (предыдущий предмет возвращается в `Equipment inventory`).

3) Состояние
- Слоты `Equipped items` хранятся в сессии.

### Статы героя (Hero Stats Table)
1) Отображение (MVP минимум)
- Как на макете: `HP`, `Phys DEF`, `Magic DEF`, `Phys ATK`, `Magic ATK`, `Crit %`, `Crit Dmg`, `Vampiric`.

2) Пересчёт
- При экипировании/снятии предмета статы пересчитываются.
- MVP-правило: базовые статы + сумма модификаторов от `Equipped items`.

3) Состояние
- В сессии хранить базовые статы героя и экипировку; итоговые статы вычислять при рендере/событиях.

### Craft inventory (currency inventory)
1) Назначение
- Применение валют/ресурсов к предмету экипировки с визуализацией таблицы статов предмета.

2) Макет (MVP)
- 4 колонки валют (фиксированные слоты) + центральный слот предмета.
- Таблица статов предмета (справа/рядом).

3) Действия (MVP)
- Перенос предмета экипировки в центральный слот (из `Equipment inventory` или `Equipped items`).
- Применение валюты к предмету:
  - ЛКМ + drag валюты на предмет — применяет эффект;
  - ПКМ по валюте — контекстное меню (для MVP можно оставить заглушку, но событие должно существовать).

4) Ограничения
- Каждый слот валюты принимает только «свой» тип валюты (строго фиксированные типы по слотам).
- Центральный слот принимает только предмет экипировки.

5) Изменения состояния
- При успешном применении валюты:
  - количество валюты уменьшается;
  - предмет изменяется (статы/редкость/значения) согласно эффекту;
  - таблица статов предмета обновляется.

### Store
1) Открытие/закрытие (MVP)
- `Store` открывается поверх монстров (оверлей).
- Должна быть возможность закрыть `Store` и вернуться к монстрам.

2) Отображение
- Сетка предметов экипировки с ценой в золоте.
- При клике по предмету показывать таблицу характеристик (как в `Craft inventory`).

3) Покупка
- ПКМ по предмету — покупка за золото и перенос в `Equipment inventory`.
- Альтернатива: ЛКМ + drag (как «нативный» вариант), но для MVP достаточно одного способа.
- Если золота недостаточно — показать уведомление об ошибке, покупку не совершать.

## Сохранение / загрузка (Persistence)
1) Сохранение в `localStorage`
- Сессия сохраняется:
  - при `Start New Game`;
  - при важных событиях: атака/смерть монстра/дроп, экипирование/снятие/свап, покупка, применение валюты в craft, изменение количества валют.
- Опционально: debounce/interval, чтобы не писать слишком часто.

2) Валидация
- При загрузке сессии проверять схему (минимум: наличие обязательных ключей).
- Если данные повреждены — считать, что сессии нет (показывать `Start New Game`).

## Список функций (контракты MVP)
Welcome:
- `hasSession(): boolean`
- `startNewGame(): void` (create + save + navigate)
- `continueGame(): void` (load + navigate)

Game (core):
- `loadSession(): GameSession`
- `saveSession(session: GameSession): void`
- `attackMonster(monsterId: string): void`
- `rollDrop(monsterId: string): DropResult`

Equipment/Equipped:
- `tryEquipItem(itemId: string, slotId: string): EquipResult`
- `unequipItem(slotId: string): void`
- `swapEquipped(slotId: string, itemId: string): void`
- `recalculateHeroStats(session: GameSession): HeroStats`

Craft:
- `setCraftItem(itemId: string | null): void` (перенос предмета в центральный слот / очистка)
- `applyCurrency(currencySlotId: string, targetItemId: string): CraftResult`
- `openCurrencyContextMenu(currencySlotId: string): void` (MVP может быть заглушкой)

Store:
- `openStore(): void`
- `closeStore(): void`
- `buyStoreItem(storeItemId: string): BuyResult`

## Нефункциональные требования (MVP)
- Все ключевые действия работают без перезагрузки страницы.
- `Continue` восстанавливает: монстров и их `HP/статус`, `Equipment inventory`, `Equipped items`, базовые статы героя, количество валют, состояние `Store` (опционально закрывать при загрузке), состояние `Craft inventory` (выбранный предмет — опционально).
- Не допускать «deep-path» зависимостей между UI-блоками: взаимодействия через `features` и публичные API.
